<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seasons Lesson Slice</title>
  <link rel="stylesheet" href="../../style-seasons-card.css">
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f5f5f5;
    }
    .layout {
      display: flex;
      gap: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .manifest-list {
      width: 260px;
      flex-shrink: 0;
    }
    .manifest-list button {
      display: block;
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      text-align: left;
      border-radius: 4px;
      font-size: 13px;
      line-height: 1.2;
    }
    .manifest-list button:hover {
      background: #e0e0e0;
    }
    .manifest-list button.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    .card-mount {
      flex: 1;
      background: white;
      border-radius: 8px;
      padding: 1rem;
      min-height: 400px;
    }
    .hint {
      max-width: 1200px;
      margin: 0 auto 12px;
      color: #475569;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>Seasons Lesson Slice - Batch 1 Preview</h1>
  <div class="hint">
    This slice renders an in-page manifest of cards for the breakfast transcript starter set.
  </div>

  <div class="layout">
    <div class="manifest-list" id="manifest-list"></div>
    <div class="card-mount" id="card-mount"></div>
  </div>

  <script src="render.js"></script>
  <script>
    const cardFiles = [
      '../../cards/breakfast-slice-001/latte.json',
      '../../cards/breakfast-slice-001/cereali.json',
      '../../cards/breakfast-slice-001/yogurt.json',
      '../../cards/breakfast-slice-001/panettone.json',
      '../../cards/breakfast-slice-001/torta.json',
      '../../cards/breakfast-slice-001/bacon.json',
      '../../cards/breakfast-slice-001/uova.json',
      '../../cards/breakfast-slice-001/weekend.json',
      '../../cards/breakfast-slice-001/sud.json',
      '../../cards/breakfast-slice-001/nord.json',
      '../../cards/breakfast-slice-001/non-siamo-abituati.json',
      '../../cards/breakfast-slice-001/mangiare-tantissimo.json',
      '../../cards/breakfast-slice-001/al-sud-si-chiamano.json',
      '../../cards/breakfast-slice-001/al-nord-si-chiamano.json'
    ];

    async function buildManifest() {
      const items = [];
      for (const path of cardFiles) {
        try {
          const res = await fetch(path);
          const data = await res.json();
          const label = data.headword.it
            ? data.headword.it + (data.headword.en ? ` (${data.headword.en})` : '')
            : data.headword.target + (data.headword.native ? ` (${data.headword.native})` : '');
          items.push({ key: data.id || data.headword.it || data.headword.target, label: label, data: data });
        } catch (e) {
          console.error("Failed to load", path, e);
        }
      }
      return items;
    }

    const listEl = document.getElementById("manifest-list");
    const mountEl = document.getElementById("card-mount");
    let manifest = [];

    function loadCardByIndex(idx) {
      const item = manifest[idx];
      if (!item) return;

      mountEl.innerHTML = "";
      window.CapiscoSeasonsCard.render(mountEl, item.data);
      updateActiveButton(item.key);
    }

    function updateActiveButton(activeKey) {
      document.querySelectorAll(".manifest-list button").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.key === activeKey);
      });
    }

    async function init() {
      manifest = await buildManifest();
      manifest.forEach((item, idx) => {
        const btn = document.createElement("button");
        btn.textContent = item.label;
        btn.dataset.key = item.key;
        btn.onclick = () => loadCardByIndex(idx);
        listEl.appendChild(btn);
      });

      if (manifest.length > 0) loadCardByIndex(0);
    }

    init();
  </script>
</body>
</html>
